<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.css' rel='stylesheet' />
    <link href='https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.1/css/all.css' rel='stylesheet'>  
    <link href='lib/main.css' rel='stylesheet' />
    <link href='main.css' rel='stylesheet' />
    <script src='lib/main.js'></script>
    <script>

    function readTextFile(file, callback) {
        var rawFile = new XMLHttpRequest();
        rawFile.overrideMimeType("application/json");
        rawFile.open("GET", file, true);
        rawFile.onreadystatechange = function() {
            if (rawFile.readyState === 4 && rawFile.status == "200") {
                callback(rawFile.responseText);
            }
        }
        rawFile.send(null);
        //return rawFile.responseText;
    }


    document.addEventListener('DOMContentLoaded', async function() {

      var calendarEl = document.getElementById('calendar');

      await readTextFile("events.json", function(text){
        var data = JSON.parse(text); 
        console.log(data);
        var calendar = new FullCalendar.Calendar(calendarEl, {
        //timeZone: 'UTC',
        height: 800,
        events: data,
        initialDate: '2021-11-07',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        // initialView: 'listWeek',
        themeSystem: 'bootstrap',
        initialView: 'dayGridMonth',
        // eventRender:   function eventRender(event, element, view) {
        //     return ['all', event.cName].indexOf(document.getElementById('type_selector').val()) >= 0;}
        dateClick: function(info) {
          if(info.view.type=="dayGridMonth"){
              this.changeView("timeGridDay",info.dateStr);
          }
        }, 
        eventMouseEnter: function( mouseEnterInfo ) { 
          var dd = data[ parseInt(mouseEnterInfo.event.id)];
          document.getElementById("img").src = dd.image;
          document.getElementById("title").textContent = dd.title;
          //console.log(dd);
          document.getElementById("description").textContent = dd.description;
        }
      });
      calendar.render();

      
    })
    // document.getElementById('type_selector').on_change = function () {
    // document.getElementById('calendar').fullCalendar('rerenderEvents');
    //};

    });



    </script>
  </head>
  <body>
  <div align='center'>
    <select id="type_selector">
      <option value="all">All types</option>
      <option value="oblo">Oblo</option>
      <option value="cinemateque">Cinemateque</option>
      <option value="zinema">Zinema</option>
      <option value="salopard">Salopard</option>
  </select>

</div>
<div class="row">
  <div class="column" id='calendar' style="max-width: 1100px;margin: 40px auto; padding: 40px"></div>
  <div class="column"><img id='img' width='400px' src=''> <h2 id='title'></h2><p id='description'></p></div>
</div>

    

    
  </body>
</html>
